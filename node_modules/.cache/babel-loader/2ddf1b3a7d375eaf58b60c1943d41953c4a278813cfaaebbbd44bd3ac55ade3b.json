{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useNavigate}from'react-router-dom';import io from'socket.io-client';import backgroundImage from'./components/background.png';import logo from'./components/logo.png';import'./MarzaPollPage.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const SERVER_URL='https://rgszh-miniapp.org';const socket=io(SERVER_URL);const MarzaPollPage=()=>{const navigate=useNavigate();const pollQuestion=\"Зачем продавать маржа?\";const initialOptions=[{text:\"Чтобы отстал руководитель\",votes:0},{text:\"Чтобы перевыполнить план и заработать много деняк\",votes:0},{text:\"Чтобы победить в конкурсе и полетать на самолёте\",votes:0},{text:\"Чтобы клиент меня любил сильнее, чем маму\",votes:0},{text:\"Какого ещё маржа? Я не в курсе\",votes:0}];const[options,setOptions]=useState(initialOptions);const[selectedIndex,setSelectedIndex]=useState(null);const[isVoted,setIsVoted]=useState(false);useEffect(()=>{socket.on('connect',()=>{console.log(\"Socket connected:\",socket.id);});socket.on('connect_error',err=>{console.error(\"Socket connection error:\",err);});socket.on('pollResults',results=>{setOptions(results);});fetch(`${SERVER_URL}/api/poll`).then(response=>response.json()).then(data=>setOptions(data)).catch(err=>console.error('Ошибка при fetch /api/poll:',err));return()=>{socket.off('pollResults');};},[]);const totalVotes=options.reduce((sum,opt)=>sum+opt.votes,0);const handleOptionSelect=index=>{if(isVoted)return;setSelectedIndex(index);fetch(`${SERVER_URL}/api/poll/vote`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({index})}).then(res=>res.json()).then(data=>{if(data.success){setIsVoted(true);}}).catch(err=>console.error('Ошибка при отправке голоса:',err));};const handleResetResults=()=>{fetch(`${SERVER_URL}/api/poll/reset`,{method:'POST',headers:{'Content-Type':'application/json'}}).then(res=>res.json()).then(data=>{if(data.success){setOptions(initialOptions);setIsVoted(false);setSelectedIndex(null);}}).catch(err=>console.error('Ошибка при сбросе результатов:',err));};const handleBack=()=>{navigate('/polls');};return/*#__PURE__*/_jsxs(\"div\",{className:\"marza-container\",style:{backgroundImage:`url(${backgroundImage})`},children:[/*#__PURE__*/_jsx(\"div\",{className:\"marza-logo-container\",children:/*#__PURE__*/_jsx(\"img\",{src:logo,alt:\"Logo\",className:\"marza-logo\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"back-btn-container\",children:/*#__PURE__*/_jsx(\"button\",{className:\"back-btn\",onClick:handleBack,children:/*#__PURE__*/_jsx(\"svg\",{xmlns:\"http://www.w3.org/2000/svg\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{d:\"M15 18l-6-6 6-6\",stroke:\"currentColor\",strokeWidth:\"2\",strokeLinecap:\"round\",strokeLinejoin:\"round\",fill:\"none\"})})})}),/*#__PURE__*/_jsx(\"div\",{className:\"reset-btn-container\",children:/*#__PURE__*/_jsx(\"button\",{className:\"reset-btn\",onClick:handleResetResults,children:/*#__PURE__*/_jsx(\"span\",{className:\"reset-btn-icon\",children:\"\\u2716\"})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"marza-content-wrapper\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"marza-title\",children:pollQuestion}),/*#__PURE__*/_jsx(\"div\",{className:\"marza-votes-counter\",children:totalVotes>0?`Всего голосов: ${totalVotes}`:'Нет голосов'}),!isVoted?/*#__PURE__*/_jsx(\"div\",{className:\"marza-options-container\",children:options.map((option,idx)=>/*#__PURE__*/_jsxs(\"label\",{className:\"marza-option-label\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",name:\"marzaPoll\",value:idx,checked:selectedIndex===idx,onChange:()=>handleOptionSelect(idx)}),/*#__PURE__*/_jsx(\"span\",{className:\"marza-option-text\",children:option.text})]},idx))}):/*#__PURE__*/_jsx(\"div\",{className:\"marza-results\",children:options.map((option,idx)=>{const percent=totalVotes>0?option.votes/totalVotes*100:0;return/*#__PURE__*/_jsxs(\"div\",{className:\"marza-result-row\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"marza-result-text\",children:[option.text,\" \\u2014 \",option.votes,\" \\u0433\\u043E\\u043B\\u043E\\u0441(\\u043E\\u0432)\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"marza-progress-bar\",children:/*#__PURE__*/_jsx(\"div\",{className:\"marza-progress-bar-filled\",style:{width:`${percent}%`}})}),/*#__PURE__*/_jsxs(\"div\",{className:\"marza-result-percent\",children:[percent.toFixed(1),\"%\"]})]},idx);})})]})]});};export default MarzaPollPage;","map":{"version":3,"names":["React","useState","useEffect","useNavigate","io","backgroundImage","logo","jsx","_jsx","jsxs","_jsxs","SERVER_URL","socket","MarzaPollPage","navigate","pollQuestion","initialOptions","text","votes","options","setOptions","selectedIndex","setSelectedIndex","isVoted","setIsVoted","on","console","log","id","err","error","results","fetch","then","response","json","data","catch","off","totalVotes","reduce","sum","opt","handleOptionSelect","index","method","headers","body","JSON","stringify","res","success","handleResetResults","handleBack","className","style","children","src","alt","onClick","xmlns","viewBox","d","stroke","strokeWidth","strokeLinecap","strokeLinejoin","fill","map","option","idx","type","name","value","checked","onChange","percent","width","toFixed"],"sources":["C:/Users/shapeless/Desktop/miniapp/src/MarzaPollPage.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport io from 'socket.io-client';\r\nimport backgroundImage from './components/background.png';\r\nimport logo from './components/logo.png';\r\nimport './MarzaPollPage.css';\r\n\r\nconst SERVER_URL = 'https://rgszh-miniapp.org';\r\nconst socket = io(SERVER_URL);\r\n\r\nconst MarzaPollPage = () => {\r\n  const navigate = useNavigate();\r\n\r\n  const pollQuestion = \"Зачем продавать маржа?\";\r\n  const initialOptions = [\r\n    { text: \"Чтобы отстал руководитель\", votes: 0 },\r\n    { text: \"Чтобы перевыполнить план и заработать много деняк\", votes: 0 },\r\n    { text: \"Чтобы победить в конкурсе и полетать на самолёте\", votes: 0 },\r\n    { text: \"Чтобы клиент меня любил сильнее, чем маму\", votes: 0 },\r\n    { text: \"Какого ещё маржа? Я не в курсе\", votes: 0 }\r\n  ];\r\n\r\n  const [options, setOptions] = useState(initialOptions);\r\n  const [selectedIndex, setSelectedIndex] = useState(null);\r\n  const [isVoted, setIsVoted] = useState(false);\r\n\r\n  useEffect(() => {\r\n    socket.on('connect', () => {\r\n      console.log(\"Socket connected:\", socket.id);\r\n    });\r\n    socket.on('connect_error', (err) => {\r\n      console.error(\"Socket connection error:\", err);\r\n    });\r\n    socket.on('pollResults', (results) => {\r\n      setOptions(results);\r\n    });\r\n\r\n    fetch(`${SERVER_URL}/api/poll`)\r\n      .then(response => response.json())\r\n      .then(data => setOptions(data))\r\n      .catch(err => console.error('Ошибка при fetch /api/poll:', err));\r\n\r\n    return () => {\r\n      socket.off('pollResults');\r\n    };\r\n  }, []);\r\n\r\n  const totalVotes = options.reduce((sum, opt) => sum + opt.votes, 0);\r\n\r\n  const handleOptionSelect = (index) => {\r\n    if (isVoted) return;\r\n    setSelectedIndex(index);\r\n\r\n    fetch(`${SERVER_URL}/api/poll/vote`, {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({ index }),\r\n    })\r\n      .then(res => res.json())\r\n      .then(data => {\r\n        if (data.success) {\r\n          setIsVoted(true);\r\n        }\r\n      })\r\n      .catch(err => console.error('Ошибка при отправке голоса:', err));\r\n  };\r\n\r\n  const handleResetResults = () => {\r\n    fetch(`${SERVER_URL}/api/poll/reset`, {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n    })\r\n      .then(res => res.json())\r\n      .then(data => {\r\n        if (data.success) {\r\n          setOptions(initialOptions);\r\n          setIsVoted(false);\r\n          setSelectedIndex(null);\r\n        }\r\n      })\r\n      .catch(err => console.error('Ошибка при сбросе результатов:', err));\r\n  };\r\n\r\n  const handleBack = () => {\r\n    navigate('/polls');\r\n  };\r\n\r\n  return (\r\n    <div className=\"marza-container\" style={{ backgroundImage: `url(${backgroundImage})` }}>\r\n      <div className=\"marza-logo-container\">\r\n        <img src={logo} alt=\"Logo\" className=\"marza-logo\" />\r\n      </div>\r\n\r\n      <div className=\"back-btn-container\">\r\n        <button className=\"back-btn\" onClick={handleBack}>\r\n          <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\">\r\n            <path d=\"M15 18l-6-6 6-6\"\r\n                  stroke=\"currentColor\"\r\n                  strokeWidth=\"2\"\r\n                  strokeLinecap=\"round\"\r\n                  strokeLinejoin=\"round\"\r\n                  fill=\"none\" />\r\n          </svg>\r\n        </button>\r\n      </div>\r\n\r\n      <div className=\"reset-btn-container\">\r\n        <button className=\"reset-btn\" onClick={handleResetResults}>\r\n          <span className=\"reset-btn-icon\">✖</span>\r\n        </button>\r\n      </div>\r\n\r\n      <div className=\"marza-content-wrapper\">\r\n        <h2 className=\"marza-title\">{pollQuestion}</h2>\r\n        <div className=\"marza-votes-counter\">\r\n          {totalVotes > 0 ? `Всего голосов: ${totalVotes}` : 'Нет голосов'}\r\n        </div>\r\n\r\n        {!isVoted ? (\r\n          <div className=\"marza-options-container\">\r\n            {options.map((option, idx) => (\r\n              <label key={idx} className=\"marza-option-label\">\r\n                <input\r\n                  type=\"radio\"\r\n                  name=\"marzaPoll\"\r\n                  value={idx}\r\n                  checked={selectedIndex === idx}\r\n                  onChange={() => handleOptionSelect(idx)}\r\n                />\r\n                <span className=\"marza-option-text\">{option.text}</span>\r\n              </label>\r\n            ))}\r\n          </div>\r\n        ) : (\r\n          <div className=\"marza-results\">\r\n            {options.map((option, idx) => {\r\n              const percent = totalVotes > 0 ? (option.votes / totalVotes) * 100 : 0;\r\n              return (\r\n                <div key={idx} className=\"marza-result-row\">\r\n                  <div className=\"marza-result-text\">\r\n                    {option.text} — {option.votes} голос(ов)\r\n                  </div>\r\n                  <div className=\"marza-progress-bar\">\r\n                    <div\r\n                      className=\"marza-progress-bar-filled\"\r\n                      style={{ width: `${percent}%` }}\r\n                    />\r\n                  </div>\r\n                  <div className=\"marza-result-percent\">\r\n                    {percent.toFixed(1)}%\r\n                  </div>\r\n                </div>\r\n              );\r\n            })}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MarzaPollPage;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}