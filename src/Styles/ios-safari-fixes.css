/* =============================================================================
   src/Styles/ios-safari-fixes.css
   Исправления для iOS Safari
   ============================================================================= */

/* 1. БАЗОВЫЕ ИСПРАВЛЕНИЯ ДЛЯ iOS SAFARI - ПОЛНОЕ ПОКРЫТИЕ ЭКРАНА */
/* Предотвращение масштабирования и скроллинга + полное покрытие */
html {
  -webkit-text-size-adjust: 100%;
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
  width: 100vw;
  height: 100vh;
  height: 100dvh;
}

body {
  -webkit-overflow-scrolling: touch;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  user-select: none;
  position: fixed;
  overflow: hidden;
  width: 100vw;
  height: 100vh;
  height: 100dvh; /* Динамическая высота viewport для iOS */
  
  /* КЛЮЧЕВОЕ: padding в safe area для контента, но фон расширяется за него */
  padding-top: env(safe-area-inset-top, 0);
  padding-bottom: env(safe-area-inset-bottom, 0);
  padding-left: env(safe-area-inset-left, 0);
  padding-right: env(safe-area-inset-right, 0);
}

/* 2. ИСПРАВЛЕНИЯ ДЛЯ SAFE AREA (iPhone с notch) */
.main-app-container {
  padding-top: env(safe-area-inset-top);
  padding-bottom: env(safe-area-inset-bottom);
  padding-left: env(safe-area-inset-left);
  padding-right: env(safe-area-inset-right);
}

/* ДОПОЛНИТЕЛЬНЫЕ ПРАВИЛА ДЛЯ 100% ПОКРЫТИЯ ЭКРАНА */
/* Специально для iOS Safari - заставляем фон покрывать ВСЁ */
@supports (-webkit-appearance: none) {
  /* РАДИКАЛЬНЫЙ ПОДХОД: убираем ВСЕ возможные белые края */
  html {
    overflow: hidden !important;
  }
  
  body {
    overflow: hidden !important;
  }
  
  #root {
    overflow: hidden !important;
  }
  
  /* Фон расширяется за safe area с гарантией покрытия */
  .gradient-background, .app-background {
    /* Используем max() для гарантии покрытия */
    width: max(100vw, calc(100vw + env(safe-area-inset-left, 0) + env(safe-area-inset-right, 0))) !important;
    height: max(100vh, calc(100vh + env(safe-area-inset-top, 0) + env(safe-area-inset-bottom, 0))) !important;
    height: max(100dvh, calc(100dvh + env(safe-area-inset-top, 0) + env(safe-area-inset-bottom, 0))) !important;
    
    /* Принудительное расширение за границы */
    margin-top: calc(-1 * env(safe-area-inset-top, 0)) !important;
    margin-bottom: calc(-1 * env(safe-area-inset-bottom, 0)) !important;
    margin-left: calc(-1 * env(safe-area-inset-left, 0)) !important;
    margin-right: calc(-1 * env(safe-area-inset-right, 0)) !important;
    
    /* Дополнительное позиционирование */
    top: calc(-1 * env(safe-area-inset-top, 0)) !important;
    bottom: calc(-1 * env(safe-area-inset-bottom, 0)) !important;
    left: calc(-1 * env(safe-area-inset-left, 0)) !important;
    right: calc(-1 * env(safe-area-inset-right, 0)) !important;
    
    /* ЭКСТРЕМАЛЬНЫЙ ПОДХОД: увеличиваем еще больше */
    transform: scale(1.1) !important;
    transform-origin: center center !important;
  }
  
  /* Убираем любые возможные белые края */
  html, body, #root {
    margin: 0 !important;
    padding: 0 !important;
    border: none !important;
    outline: none !important;
  }
  
  /* Корневой контейнер тоже должен покрывать всё */
  .main-app-container {
    width: 100vw !important;
    height: 100vh !important;
    height: 100dvh !important;
    position: relative !important;
    overflow: hidden !important;
  }
}

/* 3. ИСПРАВЛЕНИЯ ДЛЯ КНОПКИ "НАЗАД" НА iOS */
@supports (-webkit-touch-callout: none) {
  .back-btn {
    /* Пересчитываем позицию для iOS Safari */
    top: calc(87px + env(safe-area-inset-top));
    left: calc(50% - 128px - 50px + env(safe-area-inset-left));
    
    /* Убираем системные стили iOS */
    -webkit-appearance: none;
    appearance: none;
    -webkit-tap-highlight-color: transparent;
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    user-select: none;
    
    /* Улучшаем отзывчивость */
    touch-action: manipulation;
    cursor: pointer;
  }
  
  .back-btn:active {
    transform: scale(0.95);
  }
}

/* 4. ИСПРАВЛЕНИЯ ДЛЯ КНОПКИ "ВПЕРЕД" НА iOS */
@supports (-webkit-touch-callout: none) {
  .next-btn {
    /* Пересчитываем позицию для iOS Safari */
    top: calc(87px + env(safe-area-inset-top));
    right: calc(50% - 128px - 50px + env(safe-area-inset-right));
    
    /* Убираем системные стили iOS */
    -webkit-appearance: none;
    appearance: none;
    -webkit-tap-highlight-color: transparent;
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    user-select: none;
    
    /* Улучшаем отзывчивость */
    touch-action: manipulation;
    cursor: pointer;
  }
  
  .next-btn:active {
    transform: scale(0.95);
  }
}

/* 5. ИСПРАВЛЕНИЯ ДЛЯ ЛОГОТИПА НА iOS */
@supports (-webkit-touch-callout: none) {
  .logo {
    top: calc(25px + env(safe-area-inset-top));
  }
}

/* 6. ИСПРАВЛЕНИЯ ДЛЯ КОНТЕНТА НА iOS */
@supports (-webkit-touch-callout: none) {
  .welcome-text-container {
    top: calc(280px + env(safe-area-inset-top));
    padding-left: calc(20px + env(safe-area-inset-left));
    padding-right: calc(20px + env(safe-area-inset-right));
    max-height: calc(100vh - 300px - env(safe-area-inset-top) - env(safe-area-inset-bottom));
    max-height: calc(100dvh - 300px - env(safe-area-inset-top) - env(safe-area-inset-bottom));
  }
  
  .card-container {
    margin-left: env(safe-area-inset-left);
    margin-right: env(safe-area-inset-right);
    padding-bottom: calc(20px + env(safe-area-inset-bottom));
  }
  
  .main-container {
    padding-top: env(safe-area-inset-top);
    padding-bottom: env(safe-area-inset-bottom);
    padding-left: calc(20px + env(safe-area-inset-left));
    padding-right: calc(20px + env(safe-area-inset-right));
    height: 100dvh; /* Динамическая высота viewport для iOS */
  }
}

/* 7. ИСПРАВЛЕНИЯ ДЛЯ КНОПОК НА iOS */
@supports (-webkit-touch-callout: none) {
  button {
    -webkit-appearance: none;
    appearance: none;
    -webkit-tap-highlight-color: transparent;
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    user-select: none;
    touch-action: manipulation;
    cursor: pointer;
  }
  
  button:active {
    opacity: 0.8;
  }
  
  .submit-btn:active {
    transform: scale(0.98);
  }
  
  /* Исправления для кнопок в форме */
  .form-group button {
    margin-bottom: calc(10px + env(safe-area-inset-bottom));
  }
}

/* 8. ИСПРАВЛЕНИЯ ДЛЯ ПОЛЕЙ ВВОДА НА iOS */
@supports (-webkit-touch-callout: none) {
  input, select, textarea {
    -webkit-appearance: none;
    appearance: none;
    -webkit-border-radius: 0;
    border-radius: 8px;
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
  }
  
  input:focus, select:focus, textarea:focus {
    outline: none;
    -webkit-tap-highlight-color: transparent;
  }
}

/* 9. МЕДИА-ЗАПРОСЫ СПЕЦИАЛЬНО ДЛЯ iOS SAFARI */
/* iPhone SE (1-го поколения) - 320px */
@media only screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) {
  .back-btn, .next-btn {
    top: 70px;
  }
  .logo {
    top: 15px;
    width: 70px;
    height: 70px;
  }
  .welcome-text-container {
    top: 200px;
  }
}

/* iPhone 6/7/8 - 375px */
@media only screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) {
  .back-btn, .next-btn {
    top: 80px;
  }
}

/* iPhone 6+/7+/8+ - 414px */
@media only screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) {
  .back-btn, .next-btn {
    top: 90px;
  }
}

/* iPhone X/XS/11 Pro - 375px с notch */
@media only screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) {
  .back-btn, .next-btn {
    top: calc(87px + 44px); /* 44px - высота safe area top */
  }
  .logo {
    top: calc(25px + 44px);
  }
  .welcome-text-container {
    top: calc(280px + 44px);
    max-height: calc(100vh - 300px - 44px - 34px); /* 34px - safe area bottom */
  }
}

/* iPhone XR/11 - 414px с notch */
@media only screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) {
  .back-btn, .next-btn {
    top: calc(87px + 44px);
  }
  .logo {
    top: calc(25px + 44px);
  }
  .welcome-text-container {
    top: calc(280px + 44px);
    max-height: calc(100vh - 300px - 44px - 34px);
  }
}

/* iPhone XS Max/11 Pro Max - 414px с notch */
@media only screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) {
  .back-btn, .next-btn {
    top: calc(87px + 44px);
  }
  .logo {
    top: calc(25px + 44px);
  }
  .welcome-text-container {
    top: calc(280px + 44px);
    max-height: calc(100vh - 300px - 44px - 34px);
  }
}

/* iPhone 12/13/14 mini - 375px с notch */
@media only screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) {
  .back-btn, .next-btn {
    top: calc(87px + 47px); /* немного больше safe area */
  }
  .logo {
    top: calc(25px + 47px);
  }
}

/* iPhone 12/13/14/15 - 390px с notch */
@media only screen and (device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) {
  .back-btn, .next-btn {
    top: calc(87px + 47px);
  }
  .logo {
    top: calc(25px + 47px);
  }
  .welcome-text-container {
    top: calc(280px + 47px);
    max-height: calc(100vh - 300px - 47px - 34px);
  }
}

/* iPhone 12/13/14 Pro Max, 15 Plus/Pro Max - 428px с notch */
@media only screen and (device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) {
  .back-btn, .next-btn {
    top: calc(87px + 47px);
  }
  .logo {
    top: calc(25px + 47px);
  }
  .welcome-text-container {
    top: calc(280px + 47px);
    max-height: calc(100vh - 300px - 47px - 34px);
  }
}

/* 10. ИСПРАВЛЕНИЯ ДЛЯ ЛАНДШАФТНОЙ ОРИЕНТАЦИИ НА iOS */
@media screen and (orientation: landscape) and (-webkit-min-device-pixel-ratio: 1) {
  .main-container {
    height: 100vh;
    height: 100dvh;
  }
  
  .back-btn, .next-btn {
    top: calc(20px + env(safe-area-inset-top));
  }
  
  .logo {
    top: calc(10px + env(safe-area-inset-top));
    width: 60px;
    height: 60px;
  }
  
  .welcome-text-container {
    top: calc(120px + env(safe-area-inset-top));
    max-height: calc(100vh - 140px - env(safe-area-inset-top) - env(safe-area-inset-bottom));
    max-height: calc(100dvh - 140px - env(safe-area-inset-top) - env(safe-area-inset-bottom));
  }
}
